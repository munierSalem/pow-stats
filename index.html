<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ski Area Stats Scatterplot</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: "Lucida Console", Monaco, monospace, courier, "courier new", sans-serif;
      margin: 40px;
    }

    #chart-container {
      font-family: "Lucida Console", Monaco, monospace, courier, "courier new", sans-serif;
    }

    #chart-container .tick {
      font-size: 12px;
      font-family: "Lucida Console", Monaco, monospace, courier, "courier new", sans-serif;
    }

    .axis-label {
      font-size: 14px;
      font-weight: bold;
    }
    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #aaa;
      padding: 8px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
    }
    .filters {
      margin-bottom: 10px;
    }
    
    .filter-btn {
      display: inline-block;
      color: var(--btn-color);
      margin: 2px 5px;
      padding: 4px 8px;
      border: 2px solid var(--btn-color);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      background-color: #F8F8F8;
      transition: all 0.2s ease;
    }

    .filter-btn:hover {
      background-color: var(--btn-color);   /* fallback for old browsers */
      background: color-mix(in srgb, var(--btn-color) 70%, transparent);
      color: white;
      cursor: pointer;
    }

    .filter-btn.active {
      background-color: var(--btn-color);   /* fallback for old browsers */
      background-color: color-mix(in srgb, var(--btn-color) 70%, transparent);
      color: white;
    }

    .filter-btn.active:hover {
      background-color: var(--btn-color);
    }

    .scatter-point {
      fill-opacity: 0.5;
    }

    .scatter-point:hover {
      fill-opacity: 1.0;
      stroke-width: 3px;
    }

  </style>
</head>
<body>
  <h2>Ski Area Size vs. Public Boundary</h2>
  <div id="chart-container"></div>

  <script type="module">
    import { ScatterPlot } from './ScatterPlot.js';

    // Color map
    const colorMap = {
      'Eastern Canada': "#FF6F00",
      'Midwest': "#0288D1",
      'Northeast': "#2E8B57",
      'Pacific': "#FFC107",
      'Rockies': "#673AB7",
      'Western Canada': "#C62828",
    };
    d3.csv("data/ski-stats.csv").then(data => {
      data.forEach(d => {
        d.public_boundary_area = +d.public_boundary_area || 0;
        d.advertised_acres = +d.advertised_acres || 0;
        d.ratio = d.public_boundary_area > 0 ? d.advertised_acres / d.public_boundary_area : 0;
      });

      const plot = new ScatterPlot({
        containerId: "chart-container",
        data: data,
        xField: "public_boundary_area",
        yField: "ratio",
        xLabel: "Public Boundary Area",
        yLabel: "Advertised Skiable Acres / Boundary Area",
        breakoutField: "region",
        pointRadius: 5,
        xAxisArgs: {
          label: "Public Boundary Area",
          tickFormat: d3.format(".2~s")
        },
        yAxisArgs: {
          label: "Advertised Skiable Acres / Boundary Area",
          tickFormat: d3.format(".0%")
        },
        tooltipArgs: {
          text: d => `
            <strong>${d.resort_name}</strong><br/>
            ${d.state}, ${d.region}<br/>
            Boundary Area: ${d.public_boundary_area}<br/>
            Advertised Acres: ${d.advertised_acres}<br/>
            Ratio: ${d.ratio.toFixed(2)}
          `
        },
        width: 900,
        height: 600,
        colorMap: colorMap,
      });

      plot.updatePlot();
    });
  </script>
</body>
</html>
